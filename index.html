<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frigo-Chef DZ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { slate: { 950: '#020617' } },
                    fontFamily: { sans: ['Inter', 'sans-serif'], arabic: ['Cairo', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #020617; color: #e2e8f0; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .pulse-badge { animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
    </style>
</head>
<body>
    <div id="root" class="flex h-screen flex-col items-center justify-center text-white bg-slate-950 font-sans p-4 text-center">
        <h1 class="text-2xl font-bold mb-2 text-emerald-500">Frigo-Chef DZ</h1>
        <p class="text-slate-400 animate-pulse">Chargement en cours...</p>
        <div id="error-display" class="hidden mt-4 p-4 bg-red-900/50 border border-red-500 rounded text-red-200 text-sm text-left w-full max-w-md overflow-auto"></div>
    </div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const display = document.getElementById('error-display');
            display.classList.remove('hidden');
            display.innerHTML = '<strong>Erreur détectée :</strong><br/>' + message + '<br/><small>' + source + ':' + lineno + '</small>';
        };
    </script>

    <script type="text/babel">
        // --- 0. SÉCURITÉ & UTILS ---
        const { useState, useMemo, useEffect } = React;

        // Lecture sécurisée du LocalStorage
        const safeLoad = (key, fallback) => {
            try {
                const item = localStorage.getItem(key);
                // Vérification basique si c'est un JSON valide
                if (!item || item === "undefined") return fallback;
                return JSON.parse(item);
            } catch (error) {
                console.warn("Resetting data for", key);
                return fallback;
            }
        };

        // --- 1. DONNÉES INITIALES ---
        const INITIAL_INGREDIENTS = [
            { id: '1', cat: 'legume', fr: 'Tomate', ar: 'طماطم', en: 'Tomato', img: 'https://images.unsplash.com/photo-1592924357228-91a4daadcfea?w=200' },
            { id: '2', cat: 'legume', fr: 'Oignon', ar: 'بصل', en: 'Onion', img: 'https://images.unsplash.com/photo-1618512496248-a07fe83aa829?w=200' },
            { id: '3', cat: 'legume', fr: 'Pomme de terre', ar: 'بطاطا', en: 'Potato', img: 'https://images.unsplash.com/photo-1518977676601-b53f82aba655?w=200' },
            { id: '11', cat: 'legume', fr: 'Ail', ar: 'ثوم', en: 'Garlic', img: 'https://images.unsplash.com/photo-1615477210537-f81d9f8e5225?w=200' },
            { id: '4', cat: 'viande', fr: 'Poulet', ar: 'دجاج', en: 'Chicken', img: 'https://images.unsplash.com/photo-1532550907401-a500c9a57435?w=200' },
            { id: '5', cat: 'viande', fr: 'Viande Rouge', ar: 'لحم', en: 'Meat', img: 'https://images.unsplash.com/photo-1603048297172-c92544798d5e?w=200' },
            { id: '6', cat: 'epicerie', fr: 'Farine', ar: 'فرينة', en: 'Flour', img: 'https://images.unsplash.com/photo-1586585571612-47d095e1925e?w=200' },
            { id: '7', cat: 'epicerie', fr: 'Couscous', ar: 'كسكس', en: 'Couscous', img: 'https://images.unsplash.com/photo-1586548688220-3162b70f074a?w=200' },
            { id: '13', cat: 'epicerie', fr: 'Pois chiche', ar: 'حمص', en: 'Chickpeas', img: 'https://images.unsplash.com/photo-1584661848529-6799042c16f0?w=200' },
            { id: '8', cat: 'epice', fr: 'Sel', ar: 'ملح', en: 'Salt', img: 'https://images.unsplash.com/photo-1626131776934-22b62071869e?w=200' },
            { id: '14', cat: 'epice', fr: 'Poivre', ar: 'فلفل أسود', en: 'Pepper', img: 'https://images.unsplash.com/photo-1596040033229-a9821ebd058d?w=200' },
            { id: '9', cat: 'laitage', fr: 'Lait', ar: 'حليب', en: 'Milk', img: 'https://images.unsplash.com/photo-1550583724-b2692b85b150?w=200' },
            { id: '10', cat: 'laitage', fr: 'Oeufs', ar: 'بيض', en: 'Eggs', img: 'https://images.unsplash.com/photo-1491524062933-cb0289261700?w=200' }
        ];

        const INITIAL_RECIPES = [
            {
                id: 1, type: 'plat', title: { fr: "Couscous Royal", ar: "كسكس ملكي", en: "Royal Couscous" },
                img: "https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=800", time: "120", calories: "750",
                ingredients: ["1", "3", "4", "7", "11", "13"],
                instructions: { fr: ["Cuire la viande.", "Ajouter les légumes.", "Vapeur le couscous."], ar: ["طيبي اللحم.", "زيدي الخضرة.", "فوري الكسكس."], en: ["Cook meat.", "Add veggies.", "Steam couscous."] }
            },
            {
                id: 2, type: 'plat', title: { fr: "Frites Omelette", ar: "فريت أومليت", en: "Fries Omelet" },
                img: "https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=800", time: "20", calories: "400",
                ingredients: ["3", "10", "8", "14"],
                instructions: { fr: ["Frire les pommes de terre.", "Battre les oeufs.", "Mélanger."], ar: ["قلي البطاطا.", "خلطي البيض.", "خلطي كلش."], en: ["Fry potatoes.", "Beat eggs.", "Mix."] }
            }
        ];

        // --- 2. COMPOSANTS ---
        const Icon = ({ children, className, onClick }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} onClick={onClick}>{children}</svg>
        );
        
        // Icônes définies ici pour éviter les erreurs de chargement externe
        const Icons = {
            Search: (p) => <Icon {...p}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></Icon>,
            ChefHat: (p) => <Icon {...p}><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"></path><line x1="6" y1="17" x2="18" y2="17"></line></Icon>,
            Heart: (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></Icon>,
            ArrowLeft: (p) => <Icon {...p}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></Icon>,
            Plus: (p) => <Icon {...p}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x
