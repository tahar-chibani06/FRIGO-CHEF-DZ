<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frigo-Chef DZ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { slate: { 950: '#020617' }, emerald: { 600: '#059669', 500: '#10b981' } }, fontFamily: { sans: ['Inter', 'sans-serif'], arabic: ['Cairo', 'sans-serif'] } } }
        }
    </script>
    <style>
        body { background-color: #020617; color: #e2e8f0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .pulse-badge { animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        .icon { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; display: inline-block; vertical-align: middle; }
        
        /* Style des Cat√©gories Am√©lior√© */
        .cat-card {
            min-width: 100px; height: 60px; border-radius: 12px; position: relative; overflow: hidden;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            border: 1px solid #1e293b; transition: all 0.2s;
        }
        .cat-card.active { border-color: #10b981; box-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
        .cat-bg { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0.4; transition: opacity 0.2s; }
        .cat-card.active .cat-bg { opacity: 0.2; }
        .cat-content { position: relative; z-index: 10; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.8); font-size: 0.8rem; text-align: center; }
    </style>
</head>
<body class="pb-24">

    <div class="sticky top-0 z-30 bg-slate-950/95 backdrop-blur border-b border-slate-800 p-4 flex justify-between items-center">
        <h1 class="text-xl font-black flex items-center gap-2 text-white">
            <span class="bg-emerald-600 p-1 rounded shadow-lg shadow-emerald-900">üë®‚Äçüç≥</span> <span id="app-title">Frigo-Chef DZ</span>
        </h1>
        <div class="flex gap-2 items-center">
            <select id="lang-select" onchange="app.setLang(this.value)" class="bg-slate-900 border border-slate-700 text-xs font-bold text-white rounded px-2 py-1 uppercase outline-none">
                <option value="fr">FR</option><option value="ar">AR</option><option value="en">EN</option>
            </select>
            <button onclick="app.openAdmin()" class="text-slate-500 hover:text-white p-1">‚öôÔ∏è</button>
        </div>
    </div>

    <div id="app-container" class="animate-in min-h-screen"></div>

    <div class="fixed bottom-0 left-0 right-0 bg-slate-950/90 backdrop-blur border-t border-slate-900 flex justify-around p-2 pb-6 z-40 max-w-md mx-auto">
        <button onclick="app.setTab('pantry')" id="btn-pantry" class="flex flex-col items-center gap-1 p-2 rounded-xl text-slate-500 hover:text-emerald-400">
            <svg class="icon"><path d="M5 2h14a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z"/><line x1="5" y1="10" x2="19" y2="10"/><path d="M15 2v20"/></svg>
            <span class="text-[10px] font-bold">Frigo</span>
        </button>
        <button onclick="app.setTab('recipes')" id="btn-recipes" class="flex flex-col items-center gap-1 p-2 rounded-xl text-slate-500 hover:text-emerald-400">
            <svg class="icon"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></svg>
            <span class="text-[10px] font-bold">Recettes</span>
        </button>
        <button onclick="app.setTab('shop')" id="btn-shop" class="flex flex-col items-center gap-1 p-2 rounded-xl text-slate-500 hover:text-emerald-400">
            <div class="relative">
                <svg class="icon"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                <span id="shop-badge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center">0</span>
            </div>
            <span class="text-[10px] font-bold">Courses</span>
        </button>
    </div>

    <div id="modal-container" class="hidden fixed inset-0 bg-slate-950 z-50 overflow-y-auto animate-in"></div>

    <script>
        // --- 1. CONFIGURATION CAT√âGORIES (IMAGES AM√âLIOR√âES) ---
        const CATS = [
            { id: 'legume', fr: 'L√©gumes', ar: 'ÿÆÿ∂ÿ±Ÿàÿßÿ™', en: 'Veg', img: 'https://images.unsplash.com/photo-1597362925123-77861d3fbac7?w=300' },
            { id: 'viande', fr: 'Viandes', ar: 'ŸÑÿ≠ŸàŸÖ', en: 'Meat', img: 'https://images.unsplash.com/photo-1607623814075-e51df1bdc82f?w=300' },
            { id: 'epicerie', fr: '√âpicerie', ar: 'ŸÖÿ§ŸàŸÜÿ©', en: 'Pantry', img: 'https://images.unsplash.com/photo-1584269631736-427e5ad7940e?w=300' },
            { id: 'epice', fr: '√âpices', ar: 'ÿ™Ÿàÿßÿ®ŸÑ', en: 'Spices', img: 'https://images.unsplash.com/photo-1596040033229-a9821ebd058d?w=300' },
            { id: 'laitage', fr: 'Cr√®merie', ar: 'ÿ£ŸÑÿ®ÿßŸÜ', en: 'Dairy', img: 'https://images.unsplash.com/photo-1628088062854-d1870b4553da?w=300' },
        ];

        // --- 2. BASE DE DONN√âES INGR√âDIENTS (COMPL√àTE) ---
        const DEF_INGS = [
            // LEGUMES
            {id:'1',cat:'legume',fr:'Tomate',ar:'ÿ∑ŸÖÿßÿ∑ŸÖ',en:'Tomato',img:'https://images.unsplash.com/photo-1592924357228-91a4daadcfea?w=200'},
            {id:'2',cat:'legume',fr:'Oignon',ar:'ÿ®ÿµŸÑ',en:'Onion',img:'https://images.unsplash.com/photo-1618512496248-a07fe83aa829?w=200'},
            {id:'3',cat:'legume',fr:'Pomme de terre',ar:'ÿ®ÿ∑ÿßÿ∑ÿß',en:'Potato',img:'https://images.unsplash.com/photo-1518977676601-b53f82aba655?w=200'},
            {id:'4',cat:'legume',fr:'Ail',ar:'ÿ´ŸàŸÖ',en:'Garlic',img:'https://images.unsplash.com/photo-1615477210537-f81d9f8e5225?w=200'},
            {id:'5',cat:'legume',fr:'Courgette',ar:'ŸÉŸàÿ≥ÿ©',en:'Zucchini',img:'https://images.unsplash.com/photo-1590052745348-185934149021?w=200'},
            {id:'6',cat:'legume',fr:'Carotte',ar:'ÿ¨ÿ≤ÿ±',en:'Carrot',img:'https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?w=200'},
            {id:'7',cat:'legume',fr:'Piment',ar:'ŸÅŸÑŸÅŸÑ ÿ≠ÿßÿ±',en:'Chili',img:'https://images.unsplash.com/photo-1588252303782-cb80119abd6d?w=200'},
            {id:'8',cat:'legume',fr:'Poivron',ar:'ŸÅŸÑŸÅŸÑ ÿ≠ŸÑŸà',en:'Pepper',img:'https://images.unsplash.com/photo-1563565375-f3fdf5dbc239?w=200'},
            {id:'9',cat:'legume',fr:'Aubergine',ar:'ÿ®ÿßÿ∞ŸÜÿ¨ÿßŸÜ',en:'Eggplant',img:'https://images.unsplash.com/photo-1619864273822-0a2b02447e1d?w=200'},
            {id:'10',cat:'legume',fr:'Citron',ar:'ŸÑŸäŸÖŸàŸÜ',en:'Lemon',img:'https://images.unsplash.com/photo-1590502593747-42a996133562?w=200'},
            {id:'11',cat:'legume',fr:'Orange',ar:'ÿ®ÿ±ÿ™ŸÇÿßŸÑ',en:'Orange',img:'https://images.unsplash.com/photo-1611080626919-7cf5a9dbab5b?w=200'},
            {id:'12',cat:'legume',fr:'Menthe',ar:'ŸÜÿπŸÜÿßÿπ',en:'Mint',img:'https://images.unsplash.com/photo-1628556270448-4d4e614e4910?w=200'},
            {id:'13',cat:'legume',fr:'Fraise',ar:'ŸÅÿ±ÿßŸàŸÑÿ©',en:'Strawberry',img:'https://images.unsplash.com/photo-1543528176-61b239494933?w=200'},
            {id:'14',cat:'legume',fr:'Banane',ar:'ŸÖŸàÿ≤',en:'Banana',img:'https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=200'},
            {id:'15',cat:'legume',fr:'Dattes',ar:'ÿ™ŸÖÿ±',en:'Dates',img:'https://images.unsplash.com/photo-1559837627-22f3c7e7d69f?w=200'},
            // VIANDES
            {id:'20',cat:'viande',fr:'Poulet',ar:'ÿØÿ¨ÿßÿ¨',en:'Chicken',img:'https://images.unsplash.com/photo-1532550907401-a500c9a57435?w=200'},
            {id:'21',cat:'viande',fr:'Viande Rouge',ar:'ŸÑÿ≠ŸÖ',en:'Meat',img:'https://images.unsplash.com/photo-1603048297172-c92544798d5e?w=200'},
            {id:'22',cat:'viande',fr:'Viande Hach√©e',ar:'ŸÑÿ≠ŸÖ ŸÖŸÅÿ±ŸàŸÖ',en:'Minced Meat',img:'https://images.unsplash.com/photo-1564834724105-918b73d1b9e0?w=200'},
            {id:'23',cat:'viande',fr:'Merguez',ar:'ŸÖÿ±ŸÇÿßÿ≤',en:'Sausage',img:'https://images.unsplash.com/photo-1599553538421-4f1146249557?w=200'},
            {id:'24',cat:'viande',fr:'Oeufs',ar:'ÿ®Ÿäÿ∂',en:'Eggs',img:'https://images.unsplash.com/photo-1491524062933-cb0289261700?w=200'},
            // EPICERIE
            {id:'40',cat:'epicerie',fr:'Farine',ar:'ŸÅÿ±ŸäŸÜÿ©',en:'Flour',img:'https://images.unsplash.com/photo-1586585571612-47d095e1925e?w=200'},
            {id:'41',cat:'epicerie',fr:'Couscous',ar:'ŸÉÿ≥ŸÉÿ≥',en:'Couscous',img:'https://images.unsplash.com/photo-1586548688220-3162b70f074a?w=200'},
            {id:'42',cat:'epicerie',fr:'Sucre',ar:'ÿ≥ŸÉÿ±',en:'Sugar',img:'https://images.unsplash.com/photo-1616645312019-5d15a5cb3531?w=200'},
            {id:'43',cat:'epicerie',fr:'Riz',ar:'ÿ£ÿ±ÿ≤',en:'Rice',img:'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=200'},
            {id:'44',cat:'epicerie',fr:'Huile',ar:'ÿ≤Ÿäÿ™',en:'Oil',img:'https://images.unsplash.com/photo-1474979266404-7cadd91babdc?w=200'},
            {id:'45',cat:'epicerie',fr:'Miel',ar:'ÿπÿ≥ŸÑ',en:'Honey',img:'https://images.unsplash.com/photo-1587049352846-4a222e784d38?w=200'},
            {id:'46',cat:'epicerie',fr:'Pois Chiche',ar:'ÿ≠ŸÖÿµ',en:'Chickpeas',img:'https://images.unsplash.com/photo-1584661848529-6799042c16f0?w=200'},
            {id:'47',cat:'epicerie',fr:'Caf√©',ar:'ŸÇŸáŸàÿ©',en:'Coffee',img:'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=200'},
            {id:'48',cat:'epicerie',fr:'Chocolat',ar:'ÿ¥ŸàŸÉŸàŸÑÿßÿ™ÿ©',en:'Chocolate',img:'https://images.unsplash.com/photo-1511381939415-e44015466834?w=200'},
            {id:'49',cat:'epicerie',fr:'Amandes',ar:'ŸÑŸàÿ≤',en:'Almonds',img:'https://images.unsplash.com/photo-1508061253366-f7da158b6d6b?w=200'},
            // EPICES
            {id:'60',cat:'epice',fr:'Sel',ar:'ŸÖŸÑÿ≠',en:'Salt',img:'https://images.unsplash.com/photo-1626131776934-22b62071869e?w=200'},
            {id:'61',cat:'epice',fr:'Poivre',ar:'ŸÅŸÑŸÅŸÑ ÿ£ÿ≥ŸàÿØ',en:'Black Pepper',img:'https://images.unsplash.com/photo-1596040033229-a9821ebd058d?w=200'},
            {id:'62',cat:'epice',fr:'Cumin',ar:'ŸÉŸÖŸàŸÜ',en:'Cumin',img:'https://images.unsplash.com/photo-1596040033229-a9821ebd058d?w=200'},
            {id:'63',cat:'epice',fr:'Cannelle',ar:'ŸÇÿ±ŸÅÿ©',en:'Cinnamon',img:'https://images.unsplash.com/photo-1556687259-25f381c0cb1f?w=200'},
            // LAITAGE
            {id:'80',cat:'laitage',fr:'Lait',ar:'ÿ≠ŸÑŸäÿ®',en:'Milk',img:'https://images.unsplash.com/photo-1550583724-b2692b85b150?w=200'},
            {id:'81',cat:'laitage',fr:'Yaourt',ar:'Ÿäÿßÿ∫Ÿàÿ±ÿ™',en:'Yogurt',img:'https://images.unsplash.com/photo-1562122394-b1539205562d?w=200'},
            {id:'82',cat:'laitage',fr:'Beurre',ar:'ÿ≤ÿ®ÿØÿ©',en:'Butter',img:'https://images.unsplash.com/photo-1589985270826-4b7bb135bc9d?w=200'}
        ];

        // --- 3. BASE DE DONN√âES RECETTES (√âLARGIE) ---
        const DEF_RECS = [
            // PLATS (ALG√âRIENS & CLASSIQUES)
            { id: 1, type: 'plat', title: {fr:"Couscous Royal",ar:"ŸÉÿ≥ŸÉÿ≥ ŸÖŸÑŸÉŸä",en:"Royal Couscous"}, img: "https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=800", time: "120", calories: "750", ingredients: ["41","21","20","23","6","5","46"], instructions: {fr:["Sauce rouge.","Vapeur."],ar:["ŸÖÿ±ŸÇÿ©.","ŸÅŸàÿ±Ÿä."],en:["Red sauce.","Steam."]} },
            { id: 2, type: 'plat', title: {fr:"Chorba Frik",ar:"ÿ¥ÿ±ÿ®ÿ© ŸÅÿ±ŸäŸÉ",en:"Chorba Frik"}, img: "https://images.unsplash.com/photo-1547592166-23ac45744acd?w=800", time: "45", calories: "400", ingredients: ["21","1","2","12","46"], instructions: {fr:["Mijoter viande.","Tomates.","Frik."],ar:["ŸÇŸÑŸä ÿßŸÑŸÑÿ≠ŸÖ.","ÿ∑ŸÖÿßÿ∑ŸÖ.","ŸÅÿ±ŸäŸÉ."],en:["Simmer meat.","Tomatoes.","Frik."]} },
            { id: 3, type: 'plat', title: {fr:"Frites Omelette",ar:"ŸÅÿ±Ÿäÿ™ ÿ£ŸàŸÖŸÑŸäÿ™",en:"Fries Omelet"}, img: "https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=800", time: "20", calories: "450", ingredients: ["3","24","44","60"], instructions: {fr:["Frire.","Battre oeufs."],ar:["ŸÇŸÑŸä.","ÿ®Ÿäÿ∂."],en:["Fry.","Eggs."]} },
            { id: 4, type: 'plat', title: {fr:"Chakchouka",ar:"ÿ¥ŸÉÿ¥ŸàŸÉÿ©",en:"Shakshuka"}, img: "https://images.unsplash.com/photo-1590412200988-a436970781fa?w=800", time: "30", calories: "350", ingredients: ["1","2","8","24","4","44"], instructions: {fr:["Sauter oignons.","Tomates.","Oeufs."],ar:["ÿ®ÿµŸÑ.","ÿ∑ŸÖÿßÿ∑ŸÖ.","ÿ®Ÿäÿ∂."],en:["Saut√© onions.","Tomatoes.","Eggs."]} },
            { id: 5, type: 'plat', title: {fr:"Dolma",ar:"ÿØŸàŸÑŸÖÿ©",en:"Dolma"}, img: "https://images.unsplash.com/photo-1606756285524-7f2a1b5a61c3?w=800", time: "60", calories: "500", ingredients: ["5","22","3","46","63"], instructions: {fr:["Vider l√©gumes.","Farcir.","Cuire."],ar:["ÿ≠ŸÅÿ±Ÿä.","ÿπŸÖÿ±Ÿä.","ÿ∑Ÿäÿ®Ÿä."],en:["Hollow.","Stuff.","Cook."]} },
            { id: 6, type: 'plat', title: {fr:"Mhadjeb",ar:"ŸÖÿ≠ÿßÿ¨ÿ®",en:"Mhadjeb"}, img: "https://images.unsplash.com/photo-1584278860047-22db9ff82bed?w=800", time: "60", calories: "400", ingredients: ["40","2","1","44"], instructions: {fr:["P√¢te semoule.","Farce.","Cuire."],ar:["ÿπÿ¨ŸäŸÜÿ©.","ÿ≠ÿ¥Ÿà.","ÿ∑Ÿäÿ®Ÿä."],en:["Dough.","Filling.","Cook."]} },
            { id: 7, type: 'plat', title: {fr:"Rechta",ar:"ÿ±ÿ¥ÿ™ÿ©",en:"Rechta"}, img: "https://images.unsplash.com/photo-1626806812404-e3c35b5a7457?w=800", time: "60", calories: "600", ingredients: ["42","20","7","46","63"], instructions: {fr:["Sauce blanche.","Vapeur p√¢tes."],ar:["ŸÖÿ±ŸÇÿ© ÿ®Ÿäÿ∂ÿßÿ°.","ŸÅŸàÿ±Ÿä."],en:["White sauce.","Steam pasta."]} },
            { id: 8, type: 'plat', title: {fr:"Gratin Dauphinois",ar:"ÿ∫ÿ±ÿßÿ™ÿßŸÜ ÿ®ÿ∑ÿßÿ∑ÿß",en:"Potato Gratin"}, img: "https://images.unsplash.com/photo-1567115840615-18451121d37a?w=800", time: "50", calories: "550", ingredients: ["3","80","81","4","82"], instructions: {fr:["Couper.","Cuire lait.","Gratiner."],ar:["ŸÇÿ∑ÿπŸä.","ÿ≠ŸÑŸäÿ®.","ŸÉŸàÿ¥ÿ©."],en:["Slice.","Milk boil.","Bake."]} },
            
            // BOISSONS (Liste √©largie)
            { id: 30, type: 'boisson', title: {fr:"Citronnade",ar:"ÿ¥ÿßÿ±ÿ®ÿßÿ™",en:"Lemonade"}, img: "https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=800", time: "10", calories: "120", ingredients: ["10","42","80","12"], instructions: {fr:["Presser citron.","Eau, sucre, lait."],ar:["ÿπÿµÿ±Ÿä.","ŸÖÿßÿ° Ÿàÿ≥ŸÉÿ±."],en:["Juice lemon.","Mix water/sugar."]} },
            { id: 31, type: 'boisson', title: {fr:"Jus d'Orange",ar:"ÿπÿµŸäÿ± ÿ®ÿ±ÿ™ŸÇÿßŸÑ",en:"Orange Juice"}, img: "https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=800", time: "5", calories: "100", ingredients: ["11"], instructions: {fr:["Presser."],ar:["ÿπÿµÿ±Ÿä."],en:["Squeeze."]} },
            { id: 32, type: 'boisson', title: {fr:"Th√© √† la Menthe",ar:"ÿ¥ÿßŸä ÿ®ÿßŸÑŸÜÿπŸÜÿßÿπ",en:"Mint Tea"}, img: "https://images.unsplash.com/photo-1576092768241-dec231879fc3?w=800", time: "20", calories: "80", ingredients: ["12","42"], instructions: {fr:["Infuser th√©.","Menthe et sucre."],ar:["ÿ∑ÿ®ÿÆŸä.","ŸÜÿπŸÜÿßÿπ Ÿàÿ≥ŸÉÿ±."],en:["Brew tea.","Mint/sugar."]} },
            { id: 33, type: 'boisson', title: {fr:"Smoothie Banane",ar:"ÿπÿµŸäÿ± ŸÖŸàÿ≤",en:"Banana Smoothie"}, img: "https://images.unsplash.com/photo-1628557044797-f21a177c37ec?w=800", time: "5", calories: "200", ingredients: ["14","80","42"], instructions: {fr:["Mixer tout."],ar:["ÿ±ÿ≠Ÿä ŸÉŸÑÿ¥."],en:["Blend all."]} },
            { id: 34, type: 'boisson', title: {fr:"Jus de Fraise",ar:"ÿπÿµŸäÿ± ŸÅÿ±ÿßŸàŸÑÿ©",en:"Strawberry Juice"}, img: "https://images.unsplash.com/photo-1595981267035-7b04ca84a82d?w=800", time: "5", calories: "150", ingredients: ["13","42","10"], instructions: {fr:["Mixer avec eau/citron."],ar:["ÿ±ÿ≠Ÿä."],en:["Blend."]} },
            { id: 35, type: 'boisson', title: {fr:"Lben / Rayeb",ar:"ŸÑÿ®ŸÜ / ÿ±ÿßŸäÿ®",en:"Buttermilk"}, img: "https://images.unsplash.com/photo-1628088062854-d1870b4553da?w=800", time: "0", calories: "100", ingredients: ["80"], instructions: {fr:["Servir frais."],ar:["ÿ®ÿßÿ±ÿØ."],en:["Serve cold."]} },
            { id: 36, type: 'boisson', title: {fr:"Caf√© au Lait",ar:"ŸÇŸáŸàÿ© ÿ≠ŸÑŸäÿ®",en:"Latte"}, img: "https://images.unsplash.com/photo-1517701604599-bb29b5c7dd90?w=800", time: "5", calories: "80", ingredients: ["47","80","42"], instructions: {fr:["Caf√© chaud.","Lait."],ar:["ŸÇŸáŸàÿ© Ÿàÿ≠ŸÑŸäÿ®."],en:["Hot coffee.","Milk."]} },
            { id: 37, type: 'boisson', title: {fr:"Chocolat Chaud",ar:"ÿ¥ŸàŸÉŸàŸÑÿßÿ∑ÿ© ÿ≥ÿßÿÆŸÜÿ©",en:"Hot Chocolate"}, img: "https://images.unsplash.com/photo-1542990253-0d0f5be5f0ed?w=800", time: "10", calories: "300", ingredients: ["48","80","42"], instructions: {fr:["Fondre chocolat.","Lait."],ar:["ÿ∞Ÿàÿ®Ÿä ÿßŸÑÿ¥ŸÉŸàŸÑÿßÿ∑ÿ©."],en:["Melt chocolate.","Milk."]} },
            { id: 38, type: 'boisson', title: {fr:"Smoothie Datte",ar:"ÿπÿµŸäÿ± ÿßŸÑÿ™ŸÖÿ±",en:"Date Smoothie"}, img: "https://images.unsplash.com/photo-1550529889-8d82a690e03e?w=800", time: "5", calories: "350", ingredients: ["15","80","49"], instructions: {fr:["Mixer dattes et lait."],ar:["ŸÖŸÉÿ≥Ÿä ÿßŸÑÿ™ŸÖÿ± ŸàÿßŸÑÿ≠ŸÑŸäÿ®."],en:["Blend dates/milk."]} },
            { id: 39, type: 'boisson', title: {fr:"Mojito Virgin",ar:"ŸÖŸàŸáŸäÿ™Ÿà",en:"Virgin Mojito"}, img: "https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=800", time: "5", calories: "100", ingredients: ["10","12","42"], instructions: {fr:["Citron, menthe, eau gazeuse."],ar:["ŸÇÿßÿ±ÿµ ŸàŸÜÿπŸÜÿßÿπ."],en:["Lemon, mint, soda."]} },
            { id: 40, type: 'boisson', title: {fr:"Jus de Carotte",ar:"ÿπÿµŸäÿ± ÿ≤ÿ±ŸàÿØŸäÿ©",en:"Carrot Juice"}, img: "https://images.unsplash.com/photo-1598460662243-7f7223631674?w=800", time: "20", calories: "120", ingredients: ["6","11","42"], instructions: {fr:["Cuire carottes.","Mixer avec orange."],ar:["ÿ∫ŸÑŸä ÿßŸÑÿ≤ÿ±ŸàÿØŸäÿ©.","ŸÖŸÉÿ≥Ÿä."],en:["Boil carrots.","Blend."]} },

            // DESSERTS (Liste √©largie)
            { id: 60, type: 'dessert', title: {fr:"Baghrir",ar:"ÿ®ÿ∫ÿ±Ÿäÿ±",en:"Baghrir"}, img: "https://images.unsplash.com/photo-1585235882334-7d52f9540b99?w=800", time: "40", calories: "250", ingredients: ["40","41","45","82"], instructions: {fr:["P√¢te liquide.","Cuire.","Miel."],ar:["ÿπÿ¨ŸäŸÜÿ©.","ÿ∑Ÿäÿ®Ÿä.","ÿπÿ≥ŸÑ."],en:["Batter.","Cook.","Honey."]} },
            { id: 61, type: 'dessert', title: {fr:"Mouskoutchou",ar:"ŸÖŸàÿ≥ŸÉŸàÿ™ÿ¥Ÿà",en:"Sponge Cake"}, img: "https://images.unsplash.com/photo-1627834377411-8da5f4f09de8?w=800", time: "45", calories: "350", ingredients: ["24","42","44","40","10"], instructions: {fr:["M√©langer tout.","Four 180."],ar:["ÿÆŸÑÿ∑Ÿä.","ŸÉŸàÿ¥ÿ©."],en:["Mix all.","Bake."]} },
            { id: 62, type: 'dessert', title: {fr:"Tamina",ar:"ÿ∑ŸÖŸäŸÜÿ©",en:"Tamina"}, img: "https://images.unsplash.com/photo-1576023257850-252a5592bb34?w=800", time: "15", calories: "500", ingredients: ["41","45","82","63"], instructions: {fr:["Griller semoule.","Miel/Beurre."],ar:["ÿ≠ŸÖÿµŸä ÿßŸÑÿ≥ŸÖŸäÿØ.","ÿπÿ≥ŸÑ Ÿàÿ≤ÿ®ÿØÿ©."],en:["Toast semolina.","Mix honey/butter."]} },
            { id: 63, type: 'dessert', title: {fr:"Makroud",ar:"ŸÖŸÇÿ±Ÿàÿ∑",en:"Makroud"}, img: "https://images.unsplash.com/photo-1534432182912-63863115e106?w=800", time: "120", calories: "450", ingredients: ["41","15","45","44"], instructions: {fr:["P√¢te semoule.","Dattes.","Frire.","Miel."],ar:["ÿπÿ¨ŸäŸÜÿ©.","ÿ∫ÿ±ÿ≥.","ŸÇŸÑŸä.","ÿπÿ≥ŸÑ."],en:["Dough.","Dates.","Fry.","Honey."]} },
            { id: 64, type: 'dessert', title: {fr:"Cr√™pes",ar:"ŸÉÿ±Ÿäÿ®",en:"Crepes"}, img: "https://images.unsplash.com/photo-1519676867240-f03562e64548?w=800", time: "20", calories: "200", ingredients: ["40","80","24","42","82"], instructions: {fr:["P√¢te liquide.","Po√™le."],ar:["ÿÆŸÑÿ∑Ÿä.","ŸÖŸÇŸÑÿßÿ©."],en:["Batter.","Pan."]} },
            { id: 65, type: 'dessert', title: {fr:"Salade de Fruits",ar:"ÿ≥ŸÑÿ∑ÿ© ŸÅŸàÿßŸÉŸá",en:"Fruit Salad"}, img: "https://images.unsplash.com/photo-1568166666-4336021626f8?w=800", time: "15", calories: "150", ingredients: ["13","14","11","42"], instructions: {fr:["Couper fruits.","Jus."],ar:["ŸÇÿ∑ÿπŸä.","ÿπÿµŸäÿ±."],en:["Cut fruits.","Juice."]} },
            { id: 66, type: 'dessert', title: {fr:"Riz au Lait",ar:"ÿ£ÿ±ÿ≤ ÿ®ÿßŸÑÿ≠ŸÑŸäÿ®",en:"Rice Pudding"}, img: "https://images.unsplash.com/photo-1551024709-8f23befc6f87?w=800", time: "40", calories: "250", ingredients: ["43","80","42","63"], instructions: {fr:["Cuire riz eau.","Ajouter lait."],ar:["ÿ∫ŸÑŸä ÿßŸÑÿ±Ÿàÿ≤.","ÿ≠ŸÑŸäÿ®."],en:["Boil rice.","Add milk."]} },
            { id: 67, type: 'dessert', title: {fr:"Sabl√©s",ar:"ÿµÿßÿ®ŸÑŸä",en:"Shortbread"}, img: "https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=800", time: "60", calories: "400", ingredients: ["40","82","42","24"], instructions: {fr:["P√¢te sabl√©e.","Emporte-pi√®ce.","Four."],ar:["ÿπÿ¨ŸäŸÜÿ©.","ÿ∑ÿßÿ®ÿπ.","ŸÉŸàÿ¥ÿ©."],en:["Dough.","Cut.","Bake."]} },
            { id: 68, type: 'dessert', title: {fr:"Mchawek",ar:"ŸÖÿ¥ŸàŸÉ",en:"Almond Balls"}, img: "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=800", time: "45", calories: "350", ingredients: ["49","42","24"], instructions: {fr:["P√¢te amandes.","Boules.","Four."],ar:["ŸÑŸàÿ≤.","ŸÉŸàÿ±.","ŸÉŸàÿ¥ÿ©."],en:["Almond dough.","Balls.","Bake."]} },
            { id: 69, type: 'dessert', title: {fr:"Bradj",ar:"ÿ®ÿ±ÿßÿ¨",en:"Semolina Date Cake"}, img: "https://images.unsplash.com/photo-1589133465330-811c76891002?w=800", time: "60", calories: "500", ingredients: ["41","15","82"], instructions: {fr:["Sandwich semoule/dattes.","Tajine."],ar:["ÿ∑ÿ®ŸÇÿßÿ™.","ÿ∑ÿßÿ¨ŸäŸÜ."],en:["Layers.","Cook flat."]} }
        ];

        const TEXTS = {
            fr: { search: "Ingr√©dient...", find: "Voir Recettes", missing: "Manquant", have: "Complet", add: "Ajouter manquants", empty_shop: "Liste vide", no_rec: "Aucune recette (>30%)", pwd: "Mot de passe Admin:", del: "Supprimer?", save: "Enregistrer", edit: "√âditer", new: "Nouveau", admin: "Admin", back: "Retour", top_match: "TOP MATCH", empty_pantry: "Votre frigo est vide. Ajoutez des ingr√©dients !", clear_all: "Vider le frigo", all: "Tout" },
            ar: { search: "ŸÖŸÉŸàŸÜ...", find: "ÿßŸÑŸàÿµŸÅÿßÿ™", missing: "ŸÜÿßŸÇÿµ", have: "ŸÉÿßŸÖŸÑ", add: "ÿ£ÿ∂ŸÅ ÿßŸÑŸÜŸàÿßŸÇÿµ", empty_shop: "ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÅÿßÿ±ÿ∫ÿ©", no_rec: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸàÿµŸÅÿßÿ™ (>30%)", pwd: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±:", del: "ÿ≠ÿ∞ŸÅÿü", save: "ÿ≠ŸÅÿ∏", edit: "ÿ™ÿπÿØŸäŸÑ", new: "ÿ¨ÿØŸäÿØ", admin: "ÿ•ÿØÿßÿ±ÿ©", back: "ÿπŸàÿØÿ©", top_match: "ÿ™ŸàÿßŸÅŸÇ ÿπÿßŸÑŸä", empty_pantry: "ÿ´ŸÑÿßÿ¨ÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ©. ÿ£ÿ∂ŸÅ ŸÖŸÉŸàŸÜÿßÿ™!", clear_all: "ÿ•ŸÅÿ±ÿßÿ∫ ÿßŸÑÿ´ŸÑÿßÿ¨ÿ©", all: "ÿßŸÑŸÉŸÑ" },
            en: { search: "Ingredient...", find: "See Recipes", missing: "Missing", have: "All set", add: "Add missing", empty_shop: "List empty", no_rec: "No recipes (>30%)", pwd: "Admin Password:", del: "Delete?", save: "Save", edit: "Edit", new: "New", admin: "Admin", back: "Back", top_match: "TOP MATCH", empty_pantry: "Your fridge is empty. Add items!", clear_all: "Clear Fridge", all: "All" }
        };

        // --- MOTEUR JS ---
        const app = {
            state: { lang: 'fr', tab: 'pantry', pantry: [], shop: [], favs: [], ings: [], recs: [], search: '', cat: 'legume', recFilter: 'all', tempRecIngs: [] },

            init: function() {
                try {
                    this.state.pantry = JSON.parse(localStorage.getItem('fc_pantry')) || [];
                    this.state.shop = JSON.parse(localStorage.getItem('fc_shop')) || [];
                    this.state.favs = JSON.parse(localStorage.getItem('fc_favs')) || [];
                    // Chargement D√©faut si vide
                    const savedIngs = JSON.parse(localStorage.getItem('fc_ings'));
                    this.state.ings = (savedIngs && savedIngs.length > 0) ? savedIngs : DEF_INGS;
                    const savedRecs = JSON.parse(localStorage.getItem('fc_recs'));
                    this.state.recs = (savedRecs && savedRecs.length > 0) ? savedRecs : DEF_RECS;
                } catch(e) { console.log('Reset'); }
                this.render();
            },

            save: function() {
                localStorage.setItem('fc_pantry', JSON.stringify(this.state.pantry));
                localStorage.setItem('fc_shop', JSON.stringify(this.state.shop));
                localStorage.setItem('fc_favs', JSON.stringify(this.state.favs));
                localStorage.setItem('fc_ings', JSON.stringify(this.state.ings));
                localStorage.setItem('fc_recs', JSON.stringify(this.state.recs));
                this.render();
            },

            // --- NAVIGATION & ACTIONS ---
            setTab: function(tab) { this.state.tab = tab; this.render(); },
            setLang: function(lang) { this.state.lang = lang; document.body.dir = lang === 'ar' ? 'rtl' : 'ltr'; this.render(); },
            setCat: function(cat) { this.state.cat = cat; this.render(); },
            setRecFilter: function(f) { this.state.recFilter = f; this.render(); },
            
            // RECHERCHE MANUELLE
            triggerSearch: function() {
                const input = document.getElementById('search-input');
                this.state.search = input.value;
                this.render();
            },

            togglePantry: function(id) {
                const idx = this.state.pantry.indexOf(id);
                if(idx > -1) this.state.pantry.splice(idx, 1);
                else this.state.pantry.push(id);
                this.save();
            },

            clearPantry: function() {
                if(confirm(TEXTS[this.state.lang].clear_all + '?')) {
                    this.state.pantry = [];
                    this.save();
                }
            },

            addToShop: function(ids) { ids.forEach(id => { if(!this.state.shop.includes(id)) this.state.shop.push(id); }); this.state.tab = 'shop'; this.closeModal(); this.save(); },
            toggleFav: function(id, e) { if(e) e.stopPropagation(); const idx = this.state.favs.indexOf(id); if(idx > -1) this.state.favs.splice(idx, 1); else this.state.favs.push(id); this.save(); },
            toggleShop: function(id) { const idx = this.state.shop.indexOf(id); if(idx > -1) this.state.shop.splice(idx, 1); this.save(); },

            // --- RENDU UI ---
            render: function() {
                const t = TEXTS[this.state.lang];
                const container = document.getElementById('app-container');
                let html = '';

                ['pantry', 'recipes', 'shop'].forEach(t => {
                    const btn = document.getElementById('btn-'+t);
                    if(this.state.tab === t) btn.className = "flex flex-col items-center gap-1 p-2 rounded-xl text-emerald-400 bg-emerald-400/10 transition-all";
                    else btn.className = "flex flex-col items-center gap-1 p-2 rounded-xl text-slate-500 hover:text-emerald-400 transition-all";
                });
                
                const badge = document.getElementById('shop-badge');
                if(this.state.shop.length > 0) { badge.innerText = this.state.shop.length; badge.classList.remove('hidden'); } else { badge.classList.add('hidden'); }

                // --- PANTRY ---
                if (this.state.tab === 'pantry') {
                    // Barre Recherche Manuelle
                    html += `<div class="p-4 sticky top-[68px] z-20 bg-slate-950 flex gap-2">
                        <input id="search-input" value="${this.state.search}" placeholder="${t.search}" class="flex-1 bg-slate-900 border border-slate-800 p-3 rounded-xl text-white outline-none focus:border-emerald-500 transition-colors">
                        <button onclick="app.triggerSearch()" class="bg-emerald-600 text-white p-3 rounded-xl"><svg class="icon"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
                        ${this.state.pantry.length > 0 ? `<button onclick="app.clearPantry()" class="bg-red-900/50 border border-red-800 text-red-400 p-3 rounded-xl"><svg class="icon"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>` : ''}
                    </div>`;
                    
                    if(!this.state.search) {
                        html += `<div class="flex overflow-x-auto gap-3 px-4 pb-4 hide-scrollbar">`;
                        CATS.forEach(c => {
                            const active = this.state.cat === c.id ? 'active' : '';
                            html += `
                            <div onclick="app.setCat('${c.id}')" class="cat-card ${active}">
                                <div class="cat-bg" style="background-image: url('${c.img}')"></div>
                                <div class="cat-content text-white">${c[this.state.lang]||c.fr}</div>
                            </div>`;
                        });
                        html += `</div>`;
                    }

                    html += `<div class="grid grid-cols-4 sm:grid-cols-5 gap-3 p-4">`;
                    const filtered = this.state.ings.filter(i => this.state.search ? (i.fr+i.ar+i.en).toLowerCase().includes(this.state.search.toLowerCase()) : i.cat === this.state.cat);
                    
                    filtered.forEach(i => {
                        const sel = this.state.pantry.includes(i.id);
                        html += `
                        <div onclick="app.togglePantry('${i.id}')" class="flex flex-col items-center gap-2 cursor-pointer group active:scale-95 transition-transform">
                            <div class="w-16 h-16 rounded-2xl border-2 ${sel ? 'border-emerald-500 ring-2 ring-emerald-500/30' : 'border-slate-800'} overflow-hidden relative bg-slate-800 transition-all">
                                <img src="${i.img}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                                <div class="hidden items-center justify-center bg-slate-800 w-full h-full absolute top-0 left-0 text-2xl">ü•ó</div>
                                ${sel ? '<div class="absolute inset-0 bg-emerald-600/60 flex items-center justify-center text-white font-bold animate-in">‚úì</div>' : ''}
                            </div>
                            <span class="text-[10px] text-center font-bold ${sel ? 'text-emerald-400' : 'text-slate-500'} line-clamp-2 leading-tight">${i[this.state.lang]||i.fr}</span>
                        </div>`;
                    });
                    html += `</div>`;

                    if(this.state.pantry.length === 0) html += `<div class="text-center p-10 text-slate-600 flex flex-col items-center gap-4"><div class="text-4xl opacity-50">üßä</div><p>${t.empty_pantry}</p></div>`;
                    else html += `<div class="fixed bottom-24 left-4 right-4 z-30"><button onclick="app.setTab('recipes')" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-emerald-900/50 flex items-center justify-center gap-2 hover:bg-emerald-500 transition-colors animate-in">${t.find} <span class="bg-white/20 px-2 rounded-full text-xs">${this.state.pantry.length}</span></button></div>`;
                }

                // --- RECETTES ---
                else if (this.state.tab === 'recipes') {
                    html += `<div class="flex gap-2 p-4 overflow-x-auto hide-scrollbar sticky top-[68px] bg-slate-950 z-20">`;
                    ['all','plat','dessert','boisson','fav'].forEach(f => {
                        const label = f === 'all' ? t.all : f;
                        const active = this.state.recFilter === f ? 'bg-emerald-600 text-white' : 'bg-slate-900 text-slate-500 border border-slate-800';
                        html += `<button onclick="app.setRecFilter('${f}')" class="flex-1 py-2 px-4 rounded-lg text-xs font-bold capitalize whitespace-nowrap transition-all ${active}">${label}</button>`;
                    });
                    html += `</div>`;

                    html += `<div class="space-y-4 p-4">`;
                    let list = this.state.recs;
                    if(this.state.recFilter === 'fav') list = list.filter(r => this.state.favs.includes(r.id));
                    else if(this.state.recFilter !== 'all') list = list.filter(r => r.type === this.state.recFilter);

                    const scored = list.map(r => {
                        const have = r.ingredients.filter(id => this.state.pantry.includes(id));
                        const missing = r.ingredients.filter(id => !this.state.pantry.includes(id));
                        const score = r.ingredients.length ? Math.round((have.length / r.ingredients.length) * 100) : 0;
                        return { ...r, score, missing };
                    })
                    .filter(r => r.score >= 30)
                    .sort((a,b) => b.score - a.score);

                    if(scored.length === 0) html += `<div class="text-center py-20 text-slate-500 flex flex-col items-center gap-4"><div class="text-4xl opacity-50">ü§∑‚Äç‚ôÇÔ∏è</div><p>${t.no_rec}</p></div>`;
                    else {
                        scored.forEach(r => {
                            const isFav = this.state.favs.includes(r.id);
                            html += `
                            <div onclick="app.openRec(${r.id})" class="bg-slate-900 border border-slate-800 rounded-2xl p-3 flex gap-3 relative overflow-hidden group cursor-pointer hover:border-slate-700 transition-all">
                                <div class="w-24 h-24 bg-slate-800 rounded-xl overflow-hidden shrink-0 relative">
                                    <img src="${r.img}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                                    <div class="hidden items-center justify-center bg-slate-800 w-full h-full absolute top-0 left-0 text-3xl">ü•ò</div>
                                    <div class="absolute bottom-1 right-1 bg-black/60 backdrop-blur text-white text-[10px] font-bold px-1.5 rounded ${r.score >= 70 ? 'bg-emerald-600' : ''}">${r.score}%</div>
                                </div>
                                <div class="flex-1 min-w-0 flex flex-col justify-center">
                                    <div class="flex justify-between items-start">
                                        <h3 class="text-slate-200 font-bold truncate pr-4 text-lg">${r.title[this.state.lang]||r.title.fr}</h3>
                                        <button onclick="app.toggleFav(${r.id}, event)" class="${isFav ? 'text-red-500' : 'text-slate-600 hover:text-red-400'}">‚ô•</button>
                                    </div>
                                    ${r.score >= 70 ? `<div class="text-[10px] text-emerald-400 font-bold mb-1 pulse-badge w-fit px-1.5 py-0.5 rounded bg-emerald-900/20 border border-emerald-900/50">üî• ${t.top_match}</div>` : ''}
                                    <div class="text-xs text-slate-500 mb-2">${r.time} min ‚Ä¢ ${r.calories} kcal</div>
                                    <div class="flex gap-1 overflow-hidden h-5 items-center">
                                        ${r.missing.length === 0 ? `<span class="text-[10px] text-emerald-400 bg-emerald-900/20 px-2 rounded border border-emerald-900/50">‚úì ${t.have}</span>` : 
                                        `<span class="text-[10px] text-red-400 mr-1">${t.missing}:</span>` + 
                                        r.missing.slice(0,2).map(mid => `<span class="text-[10px] bg-slate-950 text-slate-400 px-1 rounded border border-slate-800 truncate max-w-[50px]">${this.getIngName(mid)}</span>`).join('')
                                        }
                                        ${r.missing.length > 2 ? `<span class="text-[10px] text-slate-500">+${r.missing.length-2}</span>` : ''}
                                    </div>
                                </div>
                            </div>`;
                        });
                    }
                    html += `</div>`;
                }

                // --- SHOP ---
                else if (this.state.tab === 'shop') {
                    html += `<div class="p-4">
                        <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800 flex justify-between items-center mb-6 shadow-lg">
                            <div><h2 class="text-xl font-bold text-white">Liste</h2><p class="text-xs text-slate-500">${this.state.shop.length} items</p></div>
                            <div class="flex gap-2">
                                <button onclick="app.shareShop()" class="bg-emerald-600/20 text-emerald-400 px-3 py-2 rounded-lg text-xs font-bold">Partager</button>
                                <button onclick="app.state.shop=[]; app.save()" class="bg-red-600/10 text-red-400 px-3 py-2 rounded-lg text-xs font-bold">Vider</button>
                            </div>
                        </div>
                        <div class="space-y-2">`;
                    if(this.state.shop.length === 0) html += `<div class="text-center py-20 text-slate-600 border-2 border-dashed border-slate-800 rounded-3xl">${t.empty_shop}</div>`;
                    this.state.shop.forEach(id => {
                        html += `<div class="flex justify-between items-center bg-slate-900 p-4 rounded-xl border border-slate-800 slide-up">
                            <div class="flex items-center gap-3"><div class="w-2 h-2 rounded-full bg-emerald-500"></div><span class="text-slate-300 font-medium">${this.getIngName(id)}</span></div>
                            <button onclick="app.toggleShop('${id}')" class="text-slate-500 hover:text-red-400">‚úï</button>
                        </div>`;
                    });
                    html += `</div></div>`;
                }
                container.innerHTML = html;
            },

            // --- HELPERS ---
            getIngName: function(id) { const i = this.state.ings.find(x => x.id === id); return i ? (i[this.state.lang] || i.fr) : id; },
            openRec: function(id) {
                const r = this.state.recs.find(x => x.id === id); if(!r) return;
                const t = TEXTS[this.state.lang];
                const missing = r.ingredients.filter(id => !this.state.pantry.includes(id));
                let html = `<div class="relative min-h-screen bg-slate-950 pb-10">
                    <div class="h-72 relative">
                        <img src="${r.img}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                        <div class="hidden items-center justify-center bg-slate-800 w-full h-full absolute top-0 left-0 text-4xl">ü•ò</div>
                        <div class="absolute inset-0 bg-gradient-to-t from-slate-950 to-transparent"></div>
                        <button onclick="app.closeModal()" class="absolute top-4 left-4 bg-black/50 text-white p-2 rounded-full backdrop-blur">‚Üê</button>
                        <div class="absolute bottom-4 left-4 right-4">
                            <h2 class="text-3xl font-black text-white mb-2">${r.title[this.state.lang]||r.title.fr}</h2>
                            <div class="flex gap-2 text-sm text-slate-300"><span class="bg-slate-900/80 px-2 py-1 rounded border border-slate-700">${r.time} min</span><span class="bg-slate-900/80 px-2 py-1 rounded border border-slate-700">${r.calories} kcal</span></div>
                        </div>
                    </div>
                    <div class="p-6">
                        ${missing.length > 0 ? `<button onclick='app.addToShop(${JSON.stringify(missing)})' class="w-full bg-red-600/20 text-red-200 border border-red-600/30 py-3 rounded-xl font-bold mb-8">+ ${t.add} (${missing.length})</button>` : ''}
                        <h3 class="text-emerald-500 font-bold uppercase text-xs tracking-widest mb-4 border-b border-slate-800 pb-2">Ingr√©dients</h3>
                        <div class="space-y-2 mb-8">${r.ingredients.map(id => { const has = this.state.pantry.includes(id); return `<div class="flex items-center gap-3 p-3 rounded-xl border ${has ? 'bg-emerald-950/30 border-emerald-500/30 text-emerald-100' : 'bg-slate-900 border-slate-800 text-slate-500'}"><div class="w-5 h-5 rounded-full flex items-center justify-center ${has ? 'bg-emerald-500 text-white' : 'bg-slate-700'}">${has ? '‚úì' : ''}</div><span>${this.getIngName(id)}</span></div>` }).join('')}</div>
                        <h3 class="text-emerald-500 font-bold uppercase text-xs tracking-widest mb-4 border-b border-slate-800 pb-2">Instructions</h3>
                        <div class="space-y-6 border-l-2 border-slate-800 pl-6 ml-2">${(r.instructions[this.state.lang]||r.instructions.fr).map((s,i) => `<div class="relative text-slate-300"><span class="absolute -left-[35px] w-8 h-8 flex items-center justify-center bg-slate-900 border border-slate-700 rounded-full text-xs font-bold text-emerald-500">${i+1}</span>${s}</div>`).join('')}</div>
                    </div>
                </div>`;
                const m = document.getElementById('modal-container'); m.innerHTML = html; m.classList.remove('hidden');
            },
            closeModal: function() { document.getElementById('modal-container').classList.add('hidden'); this.state.tempRecIngs = []; },
            shareShop: function() { const txt = "üõí Liste:\n" + this.state.shop.map(id => "- " + this.getIngName(id)).join('\n'); navigator.clipboard.writeText(txt); alert("Copi√© !"); },
            
            // --- ADMIN ---
            openAdmin: function() { const p = prompt(TEXTS[this.state.lang].pwd); if(p === 'admin123') this.renderAdmin('ings'); else if(p) alert('Erreur'); },
            renderAdmin: function(tab) {
                const m = document.getElementById('modal-container'); m.classList.remove('hidden');
                let html = `<div class="bg-slate-950 min-h-screen p-4 text-white"><div class="flex justify-between items-center mb-6 border-b border-slate-800 pb-4"><h2 class="text-xl font-bold text-emerald-500">Admin</h2><button onclick="app.closeModal()">‚úï</button></div>
                <div class="flex gap-2 mb-6"><button onclick="app.renderAdmin('ings')" class="flex-1 py-2 rounded font-bold ${tab==='ings'?'bg-emerald-600':'bg-slate-800'}">Ing</button><button onclick="app.renderAdmin('recs')" class="flex-1 py-2 rounded font-bold ${tab==='recs'?'bg-emerald-600':'bg-slate-800'}">Rec</button><button onclick="app.renderAdmin('data')" class="flex-1 py-2 rounded font-bold ${tab==='data'?'bg-emerald-600':'bg-slate-800'}">Data</button></div>`;
                
                if (tab === 'ings') {
                    html += `<form onsubmit="event.preventDefault(); app.addIng(this)" class="grid gap-2 bg-slate-900 p-4 rounded border border-slate-800 mb-4"><div class="grid grid-cols-3 gap-2"><input name="fr" placeholder="FR" class="bg-slate-950 p-2 rounded border border-slate-700" required><input name="ar" placeholder="AR" class="bg-slate-950 p-2 rounded border border-slate-700 text-right" required><input name="en" placeholder="EN" class="bg-slate-950 p-2 rounded border border-slate-700" required></div><select name="cat" class="bg-slate-950 p-2 rounded border border-slate-700">${CATS.map(c=>`<option value="${c.id}">${c.fr}</option>`).join('')}</select><input name="img" placeholder="URL Image" class="bg-slate-950 p-2 rounded border border-slate-700"><button class="bg-emerald-600 py-2 rounded font-bold">Ajouter</button></form><div class="space-y-2 pb-10">${this.state.ings.map(i => `<div class="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-800"><div class="flex items-center gap-2"><img src="${i.img}" class="w-8 h-8 rounded bg-slate-800" onerror="this.style.display='none'"><span>${i.fr}</span></div><button onclick="app.delIng('${i.id}')" class="text-red-400">üóë</button></div>`).join('')}</div>`;
                } else if (tab === 'recs') {
                    html += `<form onsubmit="event.preventDefault(); app.addRec(this)" class="grid gap-2 bg-slate-900 p-4 rounded border border-slate-800 mb-4 text-sm"><div class="grid grid-cols-3 gap-2"><input name="fr" placeholder="Titre FR" class="bg-slate-950 p-2 rounded border border-slate-700" required><input name="ar" placeholder="AR" class="bg-slate-950 p-2 rounded border border-slate-700 text-right" required><input name="en" placeholder="EN" class="bg-slate-950 p-2 rounded border border-slate-700" required></div><div class="grid grid-cols-3 gap-2"><input name="time" placeholder="Min" class="bg-slate-950 p-2 rounded border border-slate-700"><input name="cal" placeholder="Kcal" class="bg-slate-950 p-2 rounded border border-slate-700"><select name="type" class="bg-slate-950 p-2 rounded border border-slate-700"><option value="plat">Plat</option><option value="dessert">Dessert</option><option value="boisson">Boisson</option></select></div><input name="img" placeholder="URL Image" class="bg-slate-950 p-2 rounded border border-slate-700"><div class="text-xs text-slate-400 mt-2">Ingr√©dients:</div><div class="h-32 overflow-y-auto grid grid-cols-3 gap-1 bg-slate-950 p-2 rounded border border-slate-700">${this.state.ings.map(i => `<div onclick="app.toggleTempIng('${i.id}', this)" class="p-1 rounded cursor-pointer truncate bg-slate-800 text-slate-400 text-xs">${i.fr}</div>`).join('')}</div><div class="grid grid-cols-3 gap-2 mt-2"><textarea name="inst_fr" placeholder="Inst FR" class="bg-slate-950 p-2 rounded border border-slate-700 h-20 text-xs"></textarea><textarea name="inst_ar" placeholder="Inst AR" class="bg-slate-950 p-2 rounded border border-slate-700 h-20 text-xs text-right"></textarea><textarea name="inst_en" placeholder="Inst EN" class="bg-slate-950 p-2 rounded border border-slate-700 h-20 text-xs"></textarea></div><button class="bg-emerald-600 py-2 rounded font-bold mt-2">Ajouter</button></form><div class="space-y-2 pb-10">${this.state.recs.map(r => `<div class="flex justify-between items-center bg-slate-900 p-2 rounded border border-slate-800"><div class="flex items-center gap-2"><img src="${r.img}" class="w-8 h-8 rounded bg-slate-800" onerror="this.style.display='none'"><span class="truncate max-w-[150px] text-xs">${r.title.fr}</span></div><button onclick="app.delRec(${r.id})" class="text-red-400">üóë</button></div>`).join('')}</div>`;
                } else if (tab === 'data') {
                    html += `<div class="bg-slate-900 p-4 rounded border border-slate-800 space-y-4"><div><h3 class="font-bold text-emerald-400 mb-2">Import JSON</h3><input type="file" onchange="app.handleFile(this)" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-600 file:text-white hover:file:bg-emerald-700"/></div><hr class="border-slate-800"><div><h3 class="font-bold text-blue-400 mb-2">Export JSON</h3><button onclick="app.exportData()" class="bg-blue-600 px-4 py-2 rounded text-sm font-bold w-full">T√©l√©charger</button></div><hr class="border-slate-800"><button onclick="localStorage.clear(); location.reload()" class="bg-red-900/50 text-red-400 px-4 py-2 rounded text-sm font-bold w-full border border-red-900">Reset Total</button></div>`;
                }
                html += `</div>`; m.innerHTML = html;
            },
            
            // --- ADMIN HELPERS ---
            addIng: function(f) { this.state.ings.push({id:Date.now().toString(), fr:f.fr.value, ar:f.ar.value, en:f.en.value, cat:f.cat.value, img:f.img.value}); this.save(); this.renderAdmin('ings'); },
            delIng: function(id) { if(confirm('Sur?')) { this.state.ings = this.state.ings.filter(x=>x.id!==id); this.save(); this.renderAdmin('ings'); } },
            addRec: function(f) { this.state.recs.push({id:Date.now(), type:f.type.value, title:{fr:f.fr.value,ar:f.ar.value,en:f.en.value}, img:f.img.value, time:f.time.value||'30', calories:f.cal.value||'500', ingredients:[...this.state.tempRecIngs], instructions:{fr:f.inst_fr.value.split('.'), ar:f.inst_ar.value.split('.'), en:f.inst_en.value.split('.')}}); this.state.tempRecIngs=[]; this.save(); this.renderAdmin('recs'); },
            delRec: function(id) { if(confirm('Sur?')) { this.state.recs = this.state.recs.filter(x=>x.id!==id); this.save(); this.renderAdmin('recs'); } },
            toggleTempIng: function(id, el) { const idx = this.state.tempRecIngs.indexOf(id); if(idx>-1) { this.state.tempRecIngs.splice(idx,1); el.classList.remove('bg-emerald-600','text-white'); el.classList.add('bg-slate-800','text-slate-400'); } else { this.state.tempRecIngs.push(id); el.classList.remove('bg-slate-800','text-slate-400'); el.classList.add('bg-emerald-600','text-white'); } },
            handleFile: function(input) { const f = input.files[0]; if(!f) return; const r = new FileReader(); r.onload = (e) => { try { const d = JSON.parse(e.target.result); if(d.ingredients) this.state.ings = [...this.state.ings, ...d.ingredients]; if(d.recipes) this.state.recs = [...this.state.recs, ...d.recipes]; this.save(); alert('OK'); this.renderAdmin('data'); } catch(err) { alert('Error'); } }; r.readAsText(f); },
            exportData: function() { const d = {ingredients:this.state.ings, recipes:this.state.recs}; const b = new Blob([JSON.stringify(d)], {type:"application/json"}); const u = URL.createObjectURL(b); const a = document.createElement("a"); a.href = u; a.download = "data.json"; a.click(); }
        };

        // Lancement
        app.init();
    </script>
</body>
</html>
