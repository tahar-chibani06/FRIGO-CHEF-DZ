<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frigo-Chef DZ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 950: '#020617' } // Ultra dark theme default
                    }
                }
            }
        }
    </script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Optimisations UI */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        body { background-color: #020617; color: #e2e8f0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .font-arabic { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        // --- ICONS (SVG inline pour performance maximale vs FontAwesome lourd) ---
        const Icon = ({ children, className, onClick }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} onClick={onClick}>{children}</svg>
        );
        const Icons = {
            Search: (p) => <Icon {...p}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></Icon>,
            ChefHat: (p) => <Icon {...p}><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"></path><line x1="6" y1="17" x2="18" y2="17"></line></Icon>,
            Basket: (p) => <Icon {...p}><path d="m5 11 4-7"></path><path d="m19 11-4-7"></path><path d="M2 11h20"></path><path d="m3.5 11 1.6 7.4a2 2 0 0 0 2 1.6h9.8c.9 0 1.8-.7 2-1.6l1.7-7.4"></path></Icon>,
            Heart: (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></Icon>,
            ArrowLeft: (p) => <Icon {...p}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></Icon>,
            Plus: (p) => <Icon {...p}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>,
            X: (p) => <Icon {...p}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>,
            Check: (p) => <Icon {...p}><polyline points="20 6 9 17 4 12"></polyline></Icon>,
            Flame: (p) => <Icon {...p}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></Icon>,
            Settings: (p) => <Icon {...p}><path d="M12.22 2h-.44a2 2 0 0 1-2-2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73v.18a2 2 0 0 0 2 0v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V2.18a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></Icon>,
            Trash: (p) => <Icon {...p}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></Icon>,
            Edit: (p) => <Icon {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></Icon>,
            Share: (p) => <Icon {...p}><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></Icon>,
            Fridge: (p) => <Icon {...p}><path d="M5 2h14a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z"/><line x1="5" y1="10" x2="19" y2="10"/><path d="M15 2v20"/></Icon>,
            Utensils: (p) => <Icon {...p}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></Icon>,
            List: (p) => <Icon {...p}><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></Icon>,
            Globe: (p) => <Icon {...p}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></Icon>
        };

        // --- DONNÃ‰ES INITIALES (Pour le premier chargement) ---
        // Ces donnÃ©es seront copiÃ©es dans le localStorage lors de la premiÃ¨re utilisation
        const INITIAL_INGREDIENTS = [
            { id: '1', cat: 'legume', fr: 'Oignon', ar: 'Ø¨ØµÙ„', en: 'Onion', img: 'https://images.unsplash.com/photo-1618512496248-a07fe83aa829?w=200' },
            { id: '2', cat: 'legume', fr: 'Tomate', ar: 'Ø·Ù…Ø§Ø·Ù…', en: 'Tomato', img: 'https://images.unsplash.com/photo-1592924357228-91a4daadcfea?w=200' },
            { id: '3', cat: 'legume', fr: 'Pomme de terre', ar: 'Ø¨Ø·Ø§Ø·Ø§', en: 'Potato', img: 'https://images.unsplash.com/photo-1518977676601-b53f82aba655?w=200' },
            { id: '4', cat: 'viande', fr: 'Poulet', ar: 'Ø¯Ø¬Ø§Ø¬', en: 'Chicken', img: 'https://images.unsplash.com/photo-1532550907401-a500c9a57435?w=200' },
            { id: '5', cat: 'viande', fr: 'Viande Rouge', ar: 'Ù„Ø­Ù…', en: 'Meat', img: 'https://images.unsplash.com/photo-1603048297172-c92544798d5e?w=200' },
            { id: '6', cat: 'epicerie', fr: 'Farine', ar: 'ÙØ±ÙŠÙ†Ø©', en: 'Flour', img: 'https://images.unsplash.com/photo-1586585571612-47d095e1925e?w=200' },
            { id: '7', cat: 'epicerie', fr: 'Couscous', ar: 'ÙƒØ³ÙƒØ³', en: 'Couscous', img: 'https://images.unsplash.com/photo-1586548688220-3162b70f074a?w=200' },
            { id: '8', cat: 'epice', fr: 'Sel', ar: 'Ù…Ù„Ø­', en: 'Salt', img: 'https://images.unsplash.com/photo-1626131776934-22b62071869e?w=200' },
            { id: '9', cat: 'laitage', fr: 'Lait', ar: 'Ø­Ù„ÙŠØ¨', en: 'Milk', img: 'https://images.unsplash.com/photo-1550583724-b2692b85b150?w=200' },
            { id: '10', cat: 'laitage', fr: 'Oeufs', ar: 'Ø¨ÙŠØ¶', en: 'Eggs', img: 'https://images.unsplash.com/photo-1491524062933-cb0289261700?w=200' }
        ];

        const INITIAL_RECIPES = [
            {
                id: 1, type: 'plat', title: { fr: "Couscous", ar: "ÙƒØ³ÙƒØ³", en: "Couscous" },
                img: "https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=800", time: "120", calories: "750",
                ingredients: ["1", "3", "4", "7"],
                instructions: { fr: ["Cuire la viande.", "Vapeur le couscous."], ar: ["Ø·ÙŠØ¨ÙŠ Ø§Ù„Ù„Ø­Ù….", "ÙÙˆØ±ÙŠ Ø§Ù„ÙƒØ³ÙƒØ³."], en: ["Cook meat.", "Steam couscous."] }
            },
            {
                id: 2, type: 'plat', title: { fr: "Frites Omelette", ar: "ÙØ±ÙŠØª Ø£ÙˆÙ…Ù„ÙŠØª", en: "Fries Omelet" },
                img: "https://images.unsplash.com/photo-1593584785033-9c7604d0863f?w=800", time: "20", calories: "400",
                ingredients: ["3", "10", "8"],
                instructions: { fr: ["Frire patates.", "Battre oeufs."], ar: ["Ù‚Ù„ÙŠ Ø§Ù„Ø¨Ø·Ø§Ø·Ø§.", "Ø®Ù„Ø·ÙŠ Ø§Ù„Ø¨ÙŠØ¶."], en: ["Fry potatoes.", "Beat eggs."] }
            }
        ];

        const CATEGORIES = [
            { id: 'legume', fr: 'LÃ©gumes', ar: 'Ø®Ø¶Ø§Ø±', en: 'Vegetables', icon: 'ðŸ¥•' },
            { id: 'viande', fr: 'Viandes', ar: 'Ù„Ø­ÙˆÙ…', en: 'Meats', icon: 'ðŸ¥©' },
            { id: 'epicerie', fr: 'Ã‰picerie', ar: 'Ù…Ø¤ÙˆÙ†Ø©', en: 'Pantry', icon: 'ðŸŒ¾' },
            { id: 'epice', fr: 'Ã‰pices', ar: 'ØªÙˆØ§Ø¨Ù„', en: 'Spices', icon: 'ðŸŒ¶ï¸' },
            { id: 'laitage', fr: 'CrÃ¨merie', ar: 'Ø£Ù„Ø¨Ø§Ù†', en: 'Dairy', icon: 'ðŸ§€' },
        ];

        const TRANSLATIONS = {
            fr: { 
                appTitle: "Frigo-Chef DZ", search: "Rechercher...", find_btn: "Voir les Recettes", 
                missing: "Manquant", have_all: "Vous avez tout !", prep: "PrÃ©paration", add_list: "Ajouter", 
                share: "Partager", copied: "CopiÃ© !", admin: "Admin", save: "Enregistrer", cancel: "Annuler",
                delete: "Supprimer", edit: "Modifier", new_ing: "Nouvel IngrÃ©dient", new_rec: "Nouvelle Recette",
                name: "Nom", cat: "CatÃ©gorie", url: "URL Image", title: "Titre", type: "Type", 
                time: "Temps", cals: "Calories", inst: "Instructions (sÃ©parez par .)", sel_ing: "IngrÃ©dients",
                high_match: "Top CompatibilitÃ©", shop_empty: "Liste vide"
            },
            ar: { 
                appTitle: "ÙØ±ÙŠØºÙˆ-Ø´Ø§Ù Ø¯Ø²", search: "Ø¨Ø­Ø«...", find_btn: "Ø¹Ø±Ø¶ Ø§Ù„ÙˆØµÙØ§Øª", 
                missing: "ÙŠÙ†Ù‚ØµÙƒ", have_all: "Ù„Ø¯ÙŠÙƒ ÙƒÙ„ Ø´ÙŠØ¡", prep: "Ø§Ù„ØªØ­Ø¶ÙŠØ±", add_list: "Ø£Ø¶Ù", 
                share: "Ù†Ø´Ø±", copied: "ØªÙ… Ø§Ù„Ù†Ø³Ø®", admin: "Ø¥Ø¯Ø§Ø±Ø©", save: "Ø­ÙØ¸", cancel: "Ø¥Ù„ØºØ§Ø¡",
                delete: "Ø­Ø°Ù", edit: "ØªØ¹Ø¯ÙŠÙ„", new_ing: "Ù…ÙƒÙˆÙ† Ø¬Ø¯ÙŠØ¯", new_rec: "ÙˆØµÙØ© Ø¬Ø¯ÙŠØ¯Ø©",
                name: "Ø§Ù„Ø§Ø³Ù…", cat: "Ø§Ù„ÙØ¦Ø©", url: "Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©", title: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", type: "Ø§Ù„Ù†ÙˆØ¹", 
                time: "Ø§Ù„ÙˆÙ‚Øª", cals: "Ø³Ø¹Ø±Ø§Øª", inst: "Ø§Ù„Ø®Ø·ÙˆØ§Øª (Ø§ÙØµÙ„ Ø¨Ù†Ù‚Ø·Ø©)", sel_ing: "Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª",
                high_match: "ØªÙˆØ§ÙÙ‚ Ø¹Ø§Ù„ÙŠ", shop_empty: "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©"
            },
            en: {
                appTitle: "Frigo-Chef DZ", search: "Search...", find_btn: "See Recipes", 
                missing: "Missing", have_all: "You have all!", prep: "Preparation", add_list: "Add", 
                share: "Share", copied: "Copied!", admin: "Admin", save: "Save", cancel: "Cancel",
                delete: "Delete", edit: "Edit", new_ing: "New Ingredient", new_rec: "New Recipe",
                name: "Name", cat: "Category", url: "Image URL", title: "Title", type: "Type", 
                time: "Time", cals: "Calories", inst: "Instructions (split by .)", sel_ing: "Ingredients",
                high_match: "High Match", shop_empty: "List empty"
            }
        };

        // --- COMPONENTS ---

        // ADMIN : Gestion IngrÃ©dients
        const AdminIngredients = ({ ings, setIngs, t }) => {
            const [editing, setEditing] = useState(null);
            const [form, setForm] = useState({ fr: '', ar: '', en: '', cat: 'legume', img: '' });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editing) {
                    setIngs(ings.map(i => i.id === editing.id ? { ...editing, ...form } : i));
                    setEditing(null);
                } else {
                    setIngs([...ings, { id: Date.now().toString(), ...form }]);
                }
                setForm({ fr: '', ar: '', en: '', cat: 'legume', img: '' });
            };

            const handleDelete = (id) => {
                if(window.confirm('Supprimer ?')) setIngs(ings.filter(i => i.id !== id));
            }

            return (
                <div className="p-4 space-y-6">
                    <form onSubmit={handleSubmit} className="bg-slate-900 p-4 rounded-xl border border-slate-800 space-y-3">
                        <h3 className="font-bold text-emerald-400">{editing ? t.edit : t.new_ing}</h3>
                        <div className="grid grid-cols-3 gap-2">
                            <input placeholder="Nom FR" className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.fr} onChange={e => setForm({...form, fr: e.target.value})} required />
                            <input placeholder="Nom AR" className="bg-slate-950 p-2 rounded text-sm border border-slate-700 text-right" value={form.ar} onChange={e => setForm({...form, ar: e.target.value})} required />
                            <input placeholder="Name EN" className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.en} onChange={e => setForm({...form, en: e.target.value})} required />
                        </div>
                        <div className="flex gap-2">
                            <select className="bg-slate-950 p-2 rounded text-sm border border-slate-700 flex-1" value={form.cat} onChange={e => setForm({...form, cat: e.target.value})}>
                                {CATEGORIES.map(c => <option key={c.id} value={c.id}>{c.fr}</option>)}
                            </select>
                            <input placeholder={t.url} className="bg-slate-950 p-2 rounded text-sm border border-slate-700 flex-[2]" value={form.img} onChange={e => setForm({...form, img: e.target.value})} />
                        </div>
                        <div className="flex gap-2">
                            <button type="submit" className="flex-1 bg-emerald-600 p-2 rounded font-bold">{t.save}</button>
                            {editing && <button type="button" onClick={() => {setEditing(null); setForm({ fr: '', ar: '', en: '', cat: 'legume', img: '' })}} className="bg-slate-700 p-2 rounded">{t.cancel}</button>}
                        </div>
                    </form>

                    <div className="space-y-2">
                        {ings.map(ing => (
                            <div key={ing.id} className="flex items-center justify-between bg-slate-900 p-2 rounded border border-slate-800">
                                <div className="flex items-center gap-2">
                                    <img src={ing.img} className="w-8 h-8 rounded object-cover bg-slate-800" />
                                    <span className="text-sm">{ing.fr} / {ing.ar}</span>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => {setEditing(ing); setForm(ing);}} className="text-blue-400"><Icons.Edit className="w-4 h-4" /></button>
                                    <button onClick={() => handleDelete(ing.id)} className="text-red-400"><Icons.Trash className="w-4 h-4" /></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )
        };

        // ADMIN : Gestion Recettes
        const AdminRecipes = ({ recipes, setRecipes, ings, t }) => {
            const [editing, setEditing] = useState(null);
            // Form state simplified for demo
            const [form, setForm] = useState({ title_fr: '', title_ar: '', title_en: '', type: 'plat', time: '', cals: '', img: '', ingredients: [], inst_fr: '', inst_ar: '', inst_en: '' });

            const handleSubmit = (e) => {
                e.preventDefault();
                const newRecipe = {
                    id: editing ? editing.id : Date.now(),
                    type: form.type,
                    title: { fr: form.title_fr, ar: form.title_ar, en: form.title_en },
                    img: form.img,
                    time: form.time,
                    calories: form.cals,
                    ingredients: form.ingredients,
                    instructions: { 
                        fr: form.inst_fr.split('.'), 
                        ar: form.inst_ar.split('.'),
                        en: form.inst_en.split('.')
                    }
                };

                if (editing) {
                    setRecipes(recipes.map(r => r.id === editing.id ? newRecipe : r));
                    setEditing(null);
                } else {
                    setRecipes([...recipes, newRecipe]);
                }
                setForm({ title_fr: '', title_ar: '', title_en: '', type: 'plat', time: '', cals: '', img: '', ingredients: [], inst_fr: '', inst_ar: '', inst_en: '' });
            };

            const toggleIng = (id) => {
                setForm(prev => ({
                    ...prev,
                    ingredients: prev.ingredients.includes(id) 
                        ? prev.ingredients.filter(i => i !== id) 
                        : [...prev.ingredients, id]
                }));
            };

            return (
                <div className="p-4 space-y-6">
                    <form onSubmit={handleSubmit} className="bg-slate-900 p-4 rounded-xl border border-slate-800 space-y-3">
                        <h3 className="font-bold text-emerald-400">{editing ? t.edit : t.new_rec}</h3>
                        <div className="grid grid-cols-3 gap-2">
                            <input placeholder="Titre FR" className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.title_fr} onChange={e => setForm({...form, title_fr: e.target.value})} required />
                            <input placeholder="Titre AR" className="bg-slate-950 p-2 rounded text-sm border border-slate-700 text-right" value={form.title_ar} onChange={e => setForm({...form, title_ar: e.target.value})} required />
                            <input placeholder="Title EN" className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.title_en} onChange={e => setForm({...form, title_en: e.target.value})} required />
                        </div>
                        <div className="grid grid-cols-3 gap-2">
                            <input placeholder={t.time} className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.time} onChange={e => setForm({...form, time: e.target.value})} />
                            <input placeholder={t.cals} className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.cals} onChange={e => setForm({...form, cals: e.target.value})} />
                            <select className="bg-slate-950 p-2 rounded text-sm border border-slate-700" value={form.type} onChange={e => setForm({...form, type: e.target.value})}>
                                <option value="plat">Plat</option><option value="dessert">Dessert</option><option value="boisson">Boisson</option>
                            </select>
                        </div>
                        <input placeholder={t.url} className="bg-slate-950 p-2 rounded text-sm border border-slate-700 w-full" value={form.img} onChange={e => setForm({...form, img: e.target.value})} />
                        
                        <div className="text-xs text-slate-400">{t.sel_ing} ({form.ingredients.length})</div>
                        <div className="h-24 overflow-y-auto grid grid-cols-4 gap-1 bg-slate-950 p-2 rounded border border-slate-700">
                            {ings.map(ing => (
                                <div key={ing.id} onClick={() => toggleIng(ing.id)} className={`text-[10px] p-1 rounded cursor-pointer truncate ${form.ingredients.includes(ing.id) ? 'bg-emerald-600 text-white' : 'bg-slate-800 text-slate-400'}`}>
                                    {ing.fr}
                                </div>
                            ))}
                        </div>

                        <textarea placeholder="Instructions FR (sÃ©parer par .)" className="bg-slate-950 p-2 rounded text-sm border border-slate-700 w-full" value={form.inst_fr} onChange={e => setForm({...form, inst_fr: e.target.value})} />
                        <div className="flex gap-2">
                            <button type="submit" className="flex-1 bg-emerald-600 p-2 rounded font-bold">{t.save}</button>
                            {editing && <button type="button" onClick={() => setEditing(null)} className="bg-slate-700 p-2 rounded">{t.cancel}</button>}
                        </div>
                    </form>

                    <div className="space-y-2">
                        {recipes.map(rec => (
                            <div key={rec.id} className="flex items-center justify-between bg-slate-900 p-2 rounded border border-slate-800">
                                <div className="flex items-center gap-2">
                                    <img src={rec.img} className="w-8 h-8 rounded object-cover bg-slate-800" />
                                    <span className="text-sm truncate max-w-[150px]">{rec.title.fr}</span>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => {
                                        setEditing(rec);
                                        setForm({
                                            title_fr: rec.title.fr, title_ar: rec.title.ar, title_en: rec.title.en || '',
                                            type: rec.type, time: rec.time, cals: rec.calories, img: rec.img,
                                            ingredients: rec.ingredients,
                                            inst_fr: rec.instructions.fr.join('.'),
                                            inst_ar: rec.instructions.ar.join('.'),
                                            inst_en: (rec.instructions.en || []).join('.')
                                        });
                                    }} className="text-blue-400"><Icons.Edit className="w-4 h-4" /></button>
                                    <button onClick={() => {if(window.confirm('Delete?')) setRecipes(recipes.filter(r=>r.id !== rec.id))}} className="text-red-400"><Icons.Trash className="w-4 h-4" /></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )
        };

        function App() {
            // STATE
            const [lang, setLang] = useState('fr');
            const [activeTab, setActiveTab] = useState('pantry');
            const [dbIngredients, setDbIngredients] = useState([]);
            const [dbRecipes, setDbRecipes] = useState([]);
            const [pantry, setPantry] = useState([]);
            const [shopList, setShopList] = useState([]);
            const [favs, setFavs] = useState([]);
            const [selectedCat, setSelectedCat] = useState('legume');
            const [search, setSearch] = useState('');
            const [recFilter, setRecFilter] = useState('plat');
            const [selectedRec, setSelectedRec] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [adminTab, setAdminTab] = useState('ings');

            const t = TRANSLATIONS[lang];
            const isRTL = lang === 'ar';

            // INITIAL LOAD & PERSISTENCE
            useEffect(() => {
                const load = (key, def) => {
                    try {
                        const stored = localStorage.getItem(key);
                        return stored ? JSON.parse(stored) : def;
                    } catch (e) { return def; }
                };
                setDbIngredients(load('fc_db_ings', INITIAL_INGREDIENTS));
                setDbRecipes(load('fc_db_recs', INITIAL_RECIPES));
                setPantry(load('fc_pantry', []));
                setShopList(load('fc_shop', []));
                setFavs(load('fc_favs', []));
            }, []);

            useEffect(() => { if(dbIngredients.length) localStorage.setItem('fc_db_ings', JSON.stringify(dbIngredients)); }, [dbIngredients]);
            useEffect(() => { if(dbRecipes.length) localStorage.setItem('fc_db_recs', JSON.stringify(dbRecipes)); }, [dbRecipes]);
            useEffect(() => localStorage.setItem('fc_pantry', JSON.stringify(pantry)), [pantry]);
            useEffect(() => localStorage.setItem('fc_shop', JSON.stringify(shopList)), [shopList]);
            useEffect(() => localStorage.setItem('fc_favs', JSON.stringify(favs)), [favs]);

            // LOGIC
            const togglePantry = (id) => setPantry(prev => prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]);
            
            const filteredIngs = useMemo(() => {
                return dbIngredients.filter(i => {
                    const matchText = (i.fr + i.ar + (i.en||'')).toLowerCase().includes(search.toLowerCase());
                    return search ? matchText : i.cat === selectedCat;
                });
            }, [dbIngredients, search, selectedCat]);

            const matchedRecipes = useMemo(() => {
                let list = dbRecipes;
                if (recFilter === 'fav') list = list.filter(r => favs.includes(r.id));
                else list = list.filter(r => r.type === recFilter);

                return list.map(r => {
                    const have = r.ingredients.filter(id => pantry.includes(id));
                    const missing = r.ingredients.filter(id => !pantry.includes(id));
                    const score = r.ingredients.length ? Math.round((have.length / r.ingredients.length) * 100) : 0;
                    return { ...r, score, missing };
                }).sort((a, b) => b.score - a.score);
            }, [dbRecipes, pantry, recFilter, favs]);

            const addToShop = (ids) => {
                const toAdd = ids.filter(id => !shopList.includes(id));
                setShopList([...shopList, ...toAdd]);
                alert(t.add_list + ` (${toAdd.length})`);
            };

            const getIngName = (id) => {
                const ing = dbIngredients.find(i => i.id === id);
                return ing ? (ing[lang] || ing.fr) : id;
            };

            // RENDERS
            if (isAdmin) {
                return (
                    <div dir={isRTL ? 'rtl' : 'ltr'} className="min-h-screen bg-slate-950 text-slate-200 max-w-md mx-auto border-x border-slate-900">
                        <div className="flex items-center justify-between p-4 bg-slate-900 border-b border-slate-800">
                            <h2 className="font-bold flex items-center gap-2 text-emerald-500"><Icons.Settings className="w-5 h-5"/> {t.admin}</h2>
                            <button onClick={() => setIsAdmin(false)}><Icons.X className="w-6 h-6"/></button>
                        </div>
                        <div className="flex p-2 gap-2 bg-slate-900">
                            <button onClick={() => setAdminTab('ings')} className={`flex-1 py-2 rounded text-sm font-bold ${adminTab === 'ings' ? 'bg-slate-700 text-white' : 'text-slate-500'}`}>Ingredients</button>
                            <button onClick={() => setAdminTab('recs')} className={`flex-1 py-2 rounded text-sm font-bold ${adminTab === 'recs' ? 'bg-slate-700 text-white' : 'text-slate-500'}`}>Recettes</button>
                        </div>
                        {adminTab === 'ings' ? <AdminIngredients ings={dbIngredients} setIngs={setDbIngredients} t={t} /> : <AdminRecipes recipes={dbRecipes} setRecipes={setDbRecipes} ings={dbIngredients} t={t} />}
                    </div>
                );
            }

            return (
                <div dir={isRTL ? 'rtl' : 'ltr'} className={`min-h-screen bg-slate-950 text-slate-200 max-w-md mx-auto border-x border-slate-900 pb-20 relative font-sans ${isRTL ? 'font-arabic' : ''}`}>
                    {/* Header */}
                    <div className="sticky top-0 z-30 bg-slate-950/95 backdrop-blur border-b border-slate-800 p-4 flex justify-between items-center">
                        <h1 className="text-xl font-black flex items-center gap-2 tracking-tight text-white">
                            <div className="bg-emerald-600 p-1.5 rounded-lg rotate-3 shadow-lg shadow-emerald-900/50"><Icons.ChefHat className="text-white w-5 h-5" /></div>
                            {t.appTitle}
                        </h1>
                        <div className="flex gap-2">
                            <button onClick={() => setLang(l => l==='fr'?'ar':(l==='ar'?'en':'fr'))} className="text-[10px] font-bold bg-slate-900 px-2 py-1.5 rounded border border-slate-700 uppercase flex items-center gap-1">
                                <Icons.Globe className="w-3 h-3"/> {lang}
                            </button>
                            <button onClick={() => setIsAdmin(true)} className="text-slate-500 hover:text-white"><Icons.Settings className="w-5 h-5" /></button>
                        </div>
                    </div>

                    {/* Content */}
                    {activeTab === 'pantry' && (
                        <div className="animate-in">
                            <div className="p-4 sticky top-[68px] z-20 bg-slate-950/95">
                                <div className="bg-slate-900 flex items-center p-3 rounded-xl border border-slate-800 focus-within:border-emerald-500 transition-colors">
                                    <Icons.Search className="text-slate-500 w-5 h-5 mx-2" />
                                    <input value={search} onChange={e => setSearch(e.target.value)} placeholder={t.search} className="bg-transparent outline-none flex-1 placeholder-slate-600" />
                                </div>
                            </div>
                            
                            {!search && (
                                <div className="flex overflow-x-auto gap-3 p-4 pt-0 no-scrollbar">
                                    {CATEGORIES.map(c => (
                                        <button key={c.id} onClick={() => setSelectedCat(c.id)} className={`flex items-center gap-2 px-4 py-2 rounded-full whitespace-nowrap border transition-all ${selectedCat === c.id ? 'bg-emerald-600 border-emerald-500 text-white shadow-lg' : 'bg-slate-900 border-slate-800 text-slate-400'}`}>
                                            <span>{c.icon}</span><span className="font-bold text-sm">{c[lang]}</span>
                                        </button>
                                    ))}
                                </div>
                            )}

                            <div className="grid grid-cols-4 sm:grid-cols-5 gap-3 p-4">
                                {filteredIngs.map(ing => {
                                    const selected = pantry.includes(ing.id);
                                    return (
                                        <button key={ing.id} onClick={() => togglePantry(ing.id)} className="flex flex-col items-center gap-2 group active:scale-95 transition-transform">
                                            <div className={`w-16 h-16 rounded-2xl overflow-hidden border-2 relative transition-all ${selected ? 'border-emerald-500 ring-2 ring-emerald-500/30' : 'border-slate-800'}`}>
                                                <img src={ing.img} className="w-full h-full object-cover bg-white" onError={(e) => e.target.style.display='none'} />
                                                {selected && <div className="absolute inset-0 bg-emerald-600/60 flex items-center justify-center animate-in"><Icons.Check className="text-white w-8 h-8 drop-shadow-md"/></div>}
                                            </div>
                                            <span className={`text-[10px] font-bold text-center leading-tight line-clamp-2 ${selected ? 'text-emerald-400' : 'text-slate-500'}`}>{ing[lang] || ing.fr}</span>
                                        </button>
                                    )
                                })}
                            </div>

                            {pantry.length > 0 && (
                                <div className="fixed bottom-24 left-0 right-0 p-4 max-w-md mx-auto pointer-events-none">
                                    <button onClick={() => setActiveTab('recipes')} className="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold shadow-xl shadow-emerald-900/50 flex items-center justify-center gap-2 pointer-events-auto active:scale-95 transition-transform slide-up">
                                        <Icons.Flame className="w-5 h-5 animate-pulse" /> {t.find_btn} <span className="bg-white/20 px-2 py-0.5 rounded-full text-xs">{pantry.length}</span>
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {activeTab === 'recipes' && (
                        <div className="p-4 animate-in">
                            <div className="flex bg-slate-900 p-1 rounded-xl mb-4 border border-slate-800 sticky top-[70px] z-10 shadow-lg overflow-x-auto no-scrollbar">
                                {['plat', 'dessert', 'boisson', 'fav'].map(f => (
                                    <button key={f} onClick={() => setRecFilter(f)} className={`flex-1 min-w-[70px] py-2 rounded-lg text-xs font-bold capitalize transition-all ${recFilter === f ? 'bg-slate-800 text-emerald-400' : 'text-slate-500'}`}>
                                        {f}
                                    </button>
                                ))}
                            </div>
                            
                            <div className="space-y-4">
                                {matchedRecipes.map(r => (
                                    <div key={r.id} onClick={() => setSelectedRec(r)} className="bg-slate-900 border border-slate-800 rounded-2xl p-3 flex gap-3 cursor-pointer hover:border-slate-600 transition relative overflow-hidden group">
                                        <div className="w-24 h-24 bg-slate-800 rounded-xl overflow-hidden flex-shrink-0 relative">
                                            <img src={r.img} className="w-full h-full object-cover group-hover:scale-110 transition" />
                                            <div className={`absolute bottom-1 right-1 px-1.5 py-0.5 rounded text-[10px] font-bold text-white shadow-sm backdrop-blur ${r.score >= 70 ? 'bg-emerald-600' : 'bg-slate-900/80'}`}>{r.score}%</div>
                                        </div>
                                        <div className="flex-1 min-w-0 flex flex-col justify-center">
                                            <div className="flex justify-between items-start">
                                                <h3 className="text-slate-200 font-bold truncate text-lg pr-4">{r.title[lang] || r.title.fr}</h3>
                                                <button onClick={(e) => {e.stopPropagation(); setFavs(prev => prev.includes(r.id) ? prev.filter(x=>x!==r.id) : [...prev, r.id])}} className="text-slate-500 hover:text-red-500">
                                                    <Icons.Heart className={`w-5 h-5 ${favs.includes(r.id) ? 'fill-red-500 text-red-500' : ''}`} />
                                                </button>
                                            </div>
                                            {/* Badge 70% Match */}
                                            {r.score >= 70 && <div className="text-[10px] text-emerald-400 font-bold mb-1 flex items-center gap-1"><Icons.Flame className="w-3 h-3"/> {t.high_match}</div>}
                                            
                                            <div className="flex gap-3 text-xs text-slate-500 mb-2">
                                                <span>{r.time} min</span> â€¢ <span>{r.calories} kcal</span>
                                            </div>
                                            <div className="flex items-center gap-1 overflow-hidden h-5">
                                                {r.missing.length === 0 ? 
                                                    <span className="text-[10px] text-emerald-400 bg-emerald-900/20 px-2 rounded border border-emerald-900/50 flex items-center gap-1"><Icons.Check className="w-3 h-3"/> {t.have_all}</span> :
                                                    <>
                                                        <span className="text-[10px] text-red-400 mr-1 flex-shrink-0">{t.missing}:</span>
                                                        <div className="flex gap-1 overflow-hidden">
                                                            {r.missing.slice(0, 2).map(mid => <span key={mid} className="text-[10px] text-slate-400 bg-slate-950 px-1 rounded border border-slate-800 truncate max-w-[50px]">{getIngName(mid)}</span>)}
                                                            {r.missing.length > 2 && <span className="text-[10px] text-slate-500">+{r.missing.length - 2}</span>}
                                                        </div>
                                                    </>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {activeTab === 'shop' && (
                        <div className="p-4 animate-in">
                            <div className="bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-lg mb-6 flex justify-between items-center">
                                <div><h2 className="text-xl font-bold text-white">{t.admin === 'Admin' ? 'Liste' : 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª'}</h2><p className="text-xs text-slate-500">{shopList.length} items</p></div>
                                <div className="flex gap-2">
                                    <button className="bg-emerald-600/20 text-emerald-400 px-3 py-2 rounded-lg" onClick={() => navigator.clipboard.writeText(shopList.map(id => `- [ ] ${getIngName(id)}`).join('\n'))}><Icons.Share className="w-4 h-4" /></button>
                                    <button className="bg-red-600/10 text-red-400 px-3 py-2 rounded-lg" onClick={() => setShopList([])}><Icons.Trash className="w-4 h-4" /></button>
                                </div>
                            </div>
                            <div className="space-y-2">
                                {shopList.map(id => (
                                    <div key={id} className="flex items-center justify-between p-4 bg-slate-900 rounded-xl border border-slate-800 slide-up">
                                        <div className="flex items-center gap-3">
                                            <div className="w-2 h-2 rounded-full bg-emerald-500"></div>
                                            <span className="text-slate-300 font-medium">{getIngName(id)}</span>
                                        </div>
                                        <button onClick={() => setShopList(l => l.filter(x => x !== id))} className="text-slate-500 hover:text-red-400"><Icons.X className="w-5 h-5"/></button>
                                    </div>
                                ))}
                                {shopList.length === 0 && <div className="text-center py-20 text-slate-600">{t.shop_empty}</div>}
                            </div>
                        </div>
                    )}

                    {/* Navbar */}
                    <div className="fixed bottom-0 left-0 right-0 bg-slate-950/90 backdrop-blur border-t border-slate-900 flex justify-around p-2 pb-6 z-40 max-w-md mx-auto">
                        {[{id:'pantry', icon: Icons.Fridge, l:'Mon Frigo'}, {id:'recipes', icon: Icons.Utensils, l:'Recettes'}, {id:'shop', icon: Icons.List, l:'Courses'}].map(tab => (
                            <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex flex-col items-center gap-1 p-2 rounded-xl transition-all ${activeTab === tab.id ? 'text-emerald-400 bg-emerald-400/10' : 'text-slate-600'}`}>
                                <tab.icon className="w-6 h-6" />
                            </button>
                        ))}
                    </div>

                    {/* Modal Detail Recette */}
                    {selectedRec && (
                        <div className="fixed inset-0 bg-slate-950 z-50 overflow-y-auto animate-in">
                            <div className="relative h-72">
                                <img src={selectedRec.img} className="w-full h-full object-cover" />
                                <div className="absolute inset-0 bg-gradient-to-t from-slate-950 to-transparent"></div>
                                <div className="absolute top-4 left-4 z-10"><button onClick={() => setSelectedRec(null)} className="bg-black/40 p-2 rounded-full text-white backdrop-blur"><Icons.ArrowLeft className="w-6 h-6 rtl:rotate-180"/></button></div>
                                <div className="absolute bottom-4 left-4 right-4">
                                    <h2 className="text-3xl font-black text-white mb-2 leading-tight">{selectedRec.title[lang] || selectedRec.title.fr}</h2>
                                    <div className="flex gap-3 text-sm text-slate-300">
                                        <span className="bg-slate-900/80 px-3 py-1 rounded-full border border-slate-700">{selectedRec.time} min</span>
                                        <span className="bg-slate-900/80 px-3 py-1 rounded-full border border-slate-700">{selectedRec.calories} kcal</span>
                                    </div>
                                </div>
                            </div>
                            <div className="p-6 pb-20 max-w-lg mx-auto">
                                <h3 className="text-emerald-500 font-bold uppercase text-xs tracking-widest mb-4">{t.sel_ing}</h3>
                                {selectedRec.missing.length > 0 && (
                                    <button onClick={() => addToShop(selectedRec.missing)} className="w-full bg-red-600/20 border border-red-600/30 text-red-200 py-3 rounded-xl font-bold mb-6 flex items-center justify-center gap-2">
                                        <Icons.Plus className="w-4 h-4"/> {t.add_list} ({selectedRec.missing.length})
                                    </button>
                                )}
                                <div className="space-y-2 mb-8">
                                    {selectedRec.ingredients.map(id => {
                                        const has = pantry.includes(id);
                                        return (
                                            <div key={id} className={`flex items-center gap-3 p-3 rounded-xl border ${has ? 'bg-emerald-950/30 border-emerald-500/30' : 'bg-slate-900 border-slate-800'}`}>
                                                <div className={`w-5 h-5 rounded-full flex items-center justify-center ${has ? 'bg-emerald-500' : 'bg-slate-700'}`}>{has && <Icons.Check className="w-3 h-3 text-white"/>}</div>
                                                <span className={has ? 'text-slate-200' : 'text-slate-500'}>{getIngName(id)}</span>
                                            </div>
                                        )
                                    })}
                                </div>
                                <h3 className="text-emerald-500 font-bold uppercase text-xs tracking-widest mb-4">{t.prep}</h3>
                                <div className="space-y-6 border-l-2 border-slate-800 pl-6 ml-2 rtl:border-r-2 rtl:border-l-0 rtl:mr-2 rtl:pl-0 rtl:pr-6">
                                    {(selectedRec.instructions[lang] || selectedRec.instructions.fr).map((step, i) => (
                                        <div key={i} className="relative text-slate-300">
                                            <span className="absolute -left-[35px] rtl:-right-[35px] w-8 h-8 flex items-center justify-center bg-slate-900 border border-slate-700 rounded-full text-xs font-bold text-emerald-500">{i+1}</span>
                                            {step}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
